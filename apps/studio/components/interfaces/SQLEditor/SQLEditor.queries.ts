import type { SQLTemplate } from './SQLEditor.types'

export const SQL_TEMPLATES: SQLTemplate[] = [
  {
    id: 1,
    type: 'template',
    title: 'åˆ›å»ºè¡¨',
    description: 'åˆ›å»ºåŸºç¡€è¡¨çš„æ¨¡æ¿ã€‚å°†â€œtable_nameâ€æ›´æ”¹ä¸ºæ‚¨æƒ³è¦çš„åç§°ã€‚',
    sql: `create table table_name (
  id bigint generated by default as identity primary key,
  inserted_at timestamp with time zone default timezone('utc'::text, now()) not null,
  updated_at timestamp with time zone default timezone('utc'::text, now()) not null,
  data jsonb,
  name text
);`,
  },
  {
    id: 2,
    type: 'template',
    title: 'æ·»åŠ è§†å›¾',
    description:
      'æ·»åŠ è§†å›¾çš„æ¨¡æ¿ã€‚è¯·ç¡®ä¿å°†è¡¨åå’Œåˆ—åæ›´æ”¹ä¸ºå·²å­˜åœ¨çš„åç§°ã€‚',
    sql: `CREATE VIEW countries_view AS
SELECT id, continent
FROM countries;`,
  },
  {
    id: 3,
    type: 'template',
    title: 'æ·»åŠ åˆ—',
    description: 'æ·»åŠ åˆ—çš„æ¨¡æ¿ã€‚è¯·ç¡®ä¿å°†åˆ—åå’Œåˆ—ç±»å‹æ›´æ”¹ä¸ºæ‚¨æƒ³è¦çš„ã€‚',
    sql: `alter table table_name
add column new_column_name data_type;`,
  },
  {
    id: 4,
    type: 'template',
    title: 'æ·»åŠ æ³¨é‡Š',
    description: 'ä¸ºè¡¨æˆ–åˆ—æ·»åŠ æ³¨é‡Šçš„æ¨¡æ¿ã€‚',
    sql: `comment on table table_name is 'Table description';
comment on column table_name.column_name is 'Column description';`,
  },
  {
    id: 5,
    type: 'template',
    title: 'æ˜¾ç¤ºæ‰©å±•',
    description: 'è·å–æ•°æ®åº“ä¸­æ‰©å±•çš„åˆ—è¡¨å’ŒçŠ¶æ€ã€‚',
    sql: `select
  name, comment, default_version, installed_version
from
  pg_available_extensions
order by
  name asc;`,
  },
  {
    id: 6,
    type: 'template',
    title: 'æ˜¾ç¤ºç‰ˆæœ¬',
    description: 'è·å–æ‚¨çš„ Postgres ç‰ˆæœ¬ã€‚',
    sql: `select * from
  (select version()) as version,
  (select current_setting('server_version_num')) as version_number;`,
  },
  {
    id: 7,
    type: 'template',
    title: 'æ˜¾ç¤ºæ´»åŠ¨çš„è¿æ¥',
    description: 'è·å–å½“å‰æ´»åŠ¨çš„è¿æ¥æ•°ç›®å’Œå…è®¸çš„æœ€å¤§è¿æ¥æ•°ã€‚',
    sql: `select * from
(select count(pid) as active_connections FROM pg_stat_activity where state = 'active') active_connections,
(select setting as max_connections from pg_settings where name = 'max_connections') max_connections;`,
  },
  {
    id: 8,
    type: 'template',
    title: 'è‡ªåŠ¨æ›´æ–°æ—¶é—´æˆ³',
    description: 'åœ¨æ¯æ¬¡æ›´æ–°æ—¶è‡ªåŠ¨æ›´æ–°æ—¶é—´æˆ³åˆ—ã€‚',
    sql: `
create extension if not exists moddatetime schema extensions;

-- å‡è®¾è¡¨åæ˜¯â€œtodosâ€ï¼Œå¹¶ä¸”æœ‰ä¸€ä¸ªæ—¶é—´æˆ³åˆ—â€œupdated_atâ€
-- è¿™ä¸ªè§¦å‘å™¨å°†åœ¨æ¯æ¬¡æ›´æ–°æ—¶å°†â€œupdated_atâ€åˆ—è®¾ç½®ä¸ºå½“å‰æ—¶é—´æˆ³
create trigger
  handle_updated_at before update
on todos
for each row execute
  procedure moddatetime(updated_at);
  `.trim(),
  },
  {
    id: 9,
    type: 'template',
    title: 'é€’å¢å­—æ®µå€¼',
    description: 'ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹é€’å¢å­—æ®µå€¼ã€‚',
    sql: `
create function increment(row_id int)
returns void as
$$
  update table_name
  set field_name = field_name + 1
  where id = row_id;
$$
language sql volatile;

-- æ‚¨å¯ä»¥åœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨ supabase-js è°ƒç”¨æ­¤å‡½æ•°
-- const { data, error } = await supabase.rpc('increment', { row_id: 2 })
  `.trim(),
  },
  {
    id: 10,
    type: 'template',
    title: 'pg_stat_statements æŠ¥å‘Š',
    description: 'ä» pg_stat_statements ä¸­æ£€ç´¢å¹¶æŸ¥çœ‹æœ€è¿‘çš„æŸ¥è¯¢ã€‚',
    sql: `-- pg_stat_statements æŠ¥å‘Š

-- ä¸‹é¢æ·»åŠ äº†æœ€å¤š 100 æ¡çš„é™åˆ¶

select
    auth.rolname,
    statements.query,
    statements.calls,
    -- -- Postgres 13, 14
    -- statements.total_exec_time + statements.total_plan_time as total_time,
    -- statements.min_exec_time + statements.min_plan_time as min_time,
    -- statements.max_exec_time + statements.max_plan_time as max_time,
    -- statements.mean_exec_time + statements.mean_plan_time as mean_time,
    -- -- Postgres <= 12
    total_time,
    min_time,
    max_time,
    mean_time,
    statements.rows / statements.calls as avg_rows,
    statements.wal_bytes,
    statements.wal_records
  from pg_stat_statements as statements
    inner join pg_authid as auth on statements.userid = auth.oid
  order by
    total_time desc
  limit
    100;`,
  },
  {
    id: 11,
    type: 'quickstart',
    title: 'å…¨çƒçš„å›½å®¶æˆ–åœ°åŒº',
    description: 'åˆ›å»ºä¸€ä¸ªåŒ…å«å…¨çƒæ‰€æœ‰å›½å®¶æˆ–åœ°åŒºçš„è¡¨ã€‚',
    sql: `create type public.continents as enum (
    'Africa',
    'Antarctica',
    'Asia',
    'Europe',
    'Oceania',
    'North America',
    'South America'
);
create table public.countries (
  id bigint generated by default as identity primary key,
  name text,
  iso2 text not null,
  iso3 text,
  local_name text,
  continent continents
);
comment on table countries is 'Full list of countries.';
comment on column countries.name is 'Full country name.';
comment on column countries.iso2 is 'ISO 3166-1 alpha-2 code.';
comment on column countries.iso3 is 'ISO 3166-1 alpha-3 code.';
comment on column countries.local_name is 'Local variation of the name.';
insert into public.countries (name,iso2,iso3,local_name,continent) values
  ('Bonaire, Sint Eustatius and Saba','BQ','BES',null,null),
  ('CuraÃ§ao','CW','CUW',null,null),
  ('Guernsey','GG','GGY',null,null),
  ('Isle of Man','IM','IMN',null,null),
  ('Jersey','JE','JEY',null,null),
  ('Ã…land Islands','AX','ALA',null,null),
  ('Montenegro','ME','MNE',null,null),
  ('Saint BarthÃ©lemy','BL','BLM',null,null),
  ('Saint Martin (French part)','MF','MAF',null,null),
  ('Serbia','RS','SRB',null,null),
  ('Sint Maarten (Dutch part)','SX','SXM',null,null),
  ('South Sudan','SS','SSD',null,null),
  ('Timor-Leste','TL','TLS',null,null),
  ('American Samoa','as','ASM','Amerika Samoa','Oceania'),
  ('Andorra','AD','AND','Andorra','Europe'),
  ('Angola','AO','AGO','Angola','Africa'),
  ('Anguilla','AI','AIA','Anguilla','North America'),
  ('Antarctica','AQ','ATA','','Antarctica'),
  ('Antigua and Barbuda','AG','ATG','Antigua and Barbuda','North America'),
  ('Argentina','AR','ARG','Argentina','South America'),
  ('Armenia','AM','ARM','Hajastan','Asia'),
  ('Aruba','AW','ABW','Aruba','North America'),
  ('Australia','AU','AUS','Australia','Oceania'),
  ('Austria','AT','AUT','Ã–sterreich','Europe'),
  ('Azerbaijan','AZ','AZE','Azerbaijan','Asia'),
  ('Bahamas','BS','BHS','The Bahamas','North America'),
  ('Bahrain','BH','BHR','Al-Bahrayn','Asia'),
  ('Bangladesh','BD','BGD','Bangladesh','Asia'),
  ('Barbados','BB','BRB','Barbados','North America'),
  ('Belarus','BY','BLR','Belarus','Europe'),
  ('Belgium','BE','BEL','Belgium/Belgique','Europe'),
  ('Belize','BZ','BLZ','Belize','North America'),
  ('Benin','BJ','BEN','Benin','Africa'),
  ('Bermuda','BM','BMU','Bermuda','North America'),
  ('Bhutan','BT','BTN','Druk-Yul','Asia'),
  ('Bolivia','BO','BOL','Bolivia','South America'),
  ('Bosnia and Herzegovina','BA','BIH','Bosna i Hercegovina','Europe'),
  ('Botswana','BW','BWA','Botswana','Africa'),
  ('Bouvet Island','BV','BVT','Bouvet Island','Antarctica'),
  ('Brazil','BR','BRA','Brasil','South America'),
  ('British Indian Ocean Territory','IO','IOT','British Indian Ocean Territory','Africa'),
  ('Brunei Darussalam','BN','BRN','Brunei Darussalam','Asia'),
  ('Bulgaria','BG','BGR','Balgarija','Europe'),
  ('Burkina Faso','BF','BFA','Burkina Faso','Africa'),
  ('Burundi','BI','BDI','Burundi/Uburundi','Africa'),
  ('Cambodia','KH','KHM','Cambodia','Asia'),
  ('Cameroon','CM','CMR','Cameroun/Cameroon','Africa'),
  ('Canada','CA','CAN','Canada','North America'),
  ('Cape Verde','CV','CPV','Cabo Verde','Africa'),
  ('Cayman Islands','KY','CYM','Cayman Islands','North America'),
  ('Central African Republic','CF','CAF','Centrafrique','Africa'),
  ('Chad','TD','TCD','Tchad/Tshad','Africa'),
  ('Chile','CL','CHL','Chile','South America'),
  ('China','CN','CHN','Zhongguo','Asia'),
  ('Christmas Island','CX','CXR','Christmas Island','Oceania'),
  ('Cocos (Keeling) Islands','CC','CCK','Cocos (Keeling) Islands','Oceania'),
  ('Colombia','CO','COL','Colombia','South America'),
  ('Comoros','KM','COM','Komori/Comores','Africa'),
  ('Congo','CG','COG','Congo','Africa'),
  ('Congo, the Democratic Republic of the','CD','COD','Republique Democratique du Congo','Africa'),
  ('Cook Islands','CK','COK','The Cook Islands','Oceania'),
  ('Costa Rica','CR','CRI','Costa Rica','North America'),
  ('Cote DIvoire','CI','CIV','CÃ´te dIvoire','Africa'),
  ('Croatia','HR','HRV','Hrvatska','Europe'),
  ('Cuba','CU','CUB','Cuba','North America'),
  ('Cyprus','CY','CYP','Cyprus','Asia'),
  ('Czech Republic','CZ','CZE','Czech','Europe'),
  ('Denmark','DK','DNK','Danmark','Europe'),
  ('Djibouti','DJ','DJI','Djibouti/Jibuti','Africa'),
  ('Dominica','DM','DMA','Dominica','North America'),
  ('Dominican Republic','DO','DOM','Republica Dominicana','North America'),
  ('Ecuador','EC','ECU','Ecuador','South America'),
  ('Egypt','EG','EGY','Misr','Africa'),
  ('El Salvador','SV','SLV','El Salvador','North America'),
  ('Equatorial Guinea','GQ','GNQ','Guinea Ecuatorial','Africa'),
  ('Eritrea','ER','ERI','Ertra','Africa'),
  ('Estonia','EE','EST','Eesti','Europe'),
  ('Ethiopia','ET','ETH','Yeityopiya','Africa'),
  ('Falkland Islands (Malvinas)','FK','FLK','Falkland Islands','South America'),
  ('Faroe Islands','FO','FRO','Faroe Islands','Europe'),
  ('Fiji','FJ','FJI','Fiji Islands','Oceania'),
  ('Finland','FI','FIN','Suomi','Europe'),
  ('France','FR','FRA','France','Europe'),
  ('French Guiana','GF','GUF','Guyane francaise','South America'),
  ('French Polynesia','PF','PYF','PolynÃ©sie franÃ§aise','Oceania'),
  ('French Southern Territories','TF','ATF','Terres australes franÃ§aises','Antarctica'),
  ('Gabon','GA','GAB','Le Gabon','Africa'),
  ('Gambia','GM','GMB','The Gambia','Africa'),
  ('Georgia','GE','GEO','Sakartvelo','Asia'),
  ('Germany','DE','DEU','Deutschland','Europe'),
  ('Ghana','GH','GHA','Ghana','Africa'),
  ('Gibraltar','GI','GIB','Gibraltar','Europe'),
  ('Greece','GR','GRC','Greece','Europe'),
  ('Greenland','GL','GRL','Kalaallit Nunaat','North America'),
  ('Grenada','GD','GRD','Grenada','North America'),
  ('Guadeloupe','GP','GLP','Guadeloupe','North America'),
  ('Guam','GU','GUM','Guam','Oceania'),
  ('Guatemala','GT','GTM','Guatemala','North America'),
  ('Guinea','GN','GIN','Guinea','Africa'),
  ('Guinea-Bissau','GW','GNB','Guinea-Bissau','Africa'),
  ('Guyana','GY','GUY','Guyana','South America'),
  ('Haiti','HT','HTI','Haiti/Dayti','North America'),
  ('Heard Island and Mcdonald Islands','HM','HMD','Heard and McDonald Islands','Antarctica'),
  ('Holy See (Vatican City State)','VA','VAT','Santa Sede/CittÃ  del Vaticano','Europe'),
  ('Honduras','HN','HND','Honduras','North America'),
  ('Hong Kong','HK','HKG','Xianggang/Hong Kong','Asia'),
  ('Hungary','HU','HUN','Hungary','Europe'),
  ('Iceland','IS','ISL','Iceland','Europe'),
  ('India','IN','IND','Bharat/India','Asia'),
  ('Indonesia','ID','IDN','Indonesia','Asia'),
  ('Iran, Islamic Republic of','IR','IRN','Iran','Asia'),
  ('Iraq','IQ','IRQ','Al-IrÄq','Asia'),
  ('Ireland','IE','IRL','Ireland','Europe'),
  ('Israel','IL','ISR','Yisrael','Asia'),
  ('Italy','IT','ITA','Italia','Europe'),
  ('Jamaica','JM','JAM','Jamaica','North America'),
  ('Japan','JP','JPN','Nihon/Nippon','Asia'),
  ('Jordan','JO','JOR','Al-Urdunn','Asia'),
  ('Kazakhstan','KZ','KAZ','Qazaqstan','Asia'),
  ('Kenya','KE','KEN','Kenya','Africa'),
  ('Kiribati','KI','KIR','Kiribati','Oceania'),
  ('Korea, Democratic People''s Republic of','KP','PRK','Choson Minjujuui Inmin Konghwaguk (Bukhan)','Asia'),
  ('Korea, Republic of','KR','KOR','Taehan-minguk (Namhan)','Asia'),
  ('Kuwait','KW','KWT','Al-Kuwayt','Asia'),
  ('Kyrgyzstan','KG','KGZ','Kyrgyzstan','Asia'),
  ('Lao People''s Democratic Republic','LA','LAO','Lao','Asia'),
  ('Latvia','LV','LVA','Latvija','Europe'),
  ('Lebanon','LB','LBN','Lubnan','Asia'),
  ('Lesotho','LS','LSO','Lesotho','Africa'),
  ('Liberia','LR','LBR','Liberia','Africa'),
  ('Libya','LY','LBY','Libiya','Africa'),
  ('Liechtenstein','LI','LIE','Liechtenstein','Europe'),
  ('Lithuania','LT','LTU','Lietuva','Europe'),
  ('Luxembourg','LU','LUX','Luxembourg','Europe'),
  ('Macao','MO','MAC','Macau/Aomen','Asia'),
  ('Macedonia, the Former Yugoslav Republic of','MK','MKD','Makedonija','Europe'),
  ('Madagascar','MG','MDG','Madagasikara/Madagascar','Africa'),
  ('Malawi','MW','MWI','Malawi','Africa'),
  ('Malaysia','MY','MYS','Malaysia','Asia'),
  ('Maldives','MV','MDV','Dhivehi Raajje/Maldives','Asia'),
  ('Mali','ML','MLI','Mali','Africa'),
  ('Malta','MT','MLT','Malta','Europe'),
  ('Marshall Islands','MH','MHL','Marshall Islands/Majol','Oceania'),
  ('Martinique','MQ','MTQ','Martinique','North America'),
  ('Mauritania','MR','MRT','Muritaniya/Mauritanie','Africa'),
  ('Mauritius','MU','MUS','Mauritius','Africa'),
  ('Mayotte','YT','MYT','Mayotte','Africa'),
  ('Mexico','MX','MEX','Mexico','North America'),
  ('Micronesia, Federated States of','FM','FSM','Micronesia','Oceania'),
  ('Moldova, Republic of','MD','MDA','Moldova','Europe'),
  ('Monaco','MC','MCO','Monaco','Europe'),
  ('Mongolia','MN','MNG','Mongol Uls','Asia'),
  ('Albania','AL','ALB','Republika e ShqipÃ«risÃ«','Europe'),
  ('Montserrat','MS','MSR','Montserrat','North America'),
  ('Morocco','MA','MAR','Al-Maghrib','Africa'),
  ('Mozambique','MZ','MOZ','Mozambique','Africa'),
  ('Myanmar','MM','MMR','Myanma Pye','Asia'),
  ('Namibia','NA','NAM','Namibia','Africa'),
  ('Nauru','NR','NRU','Naoero/Nauru','Oceania'),
  ('Nepal','NP','NPL','Nepal','Asia'),
  ('Netherlands','NL','NLD','Nederland','Europe'),
  ('New Caledonia','NC','NCL','Nouvelle-CalÃ©donie','Oceania'),
  ('New Zealand','NZ','NZL','New Zealand/Aotearoa','Oceania'),
  ('Nicaragua','NI','NIC','Nicaragua','North America'),
  ('Niger','NE','NER','Niger','Africa'),
  ('Nigeria','NG','NGA','Nigeria','Africa'),
  ('Niue','NU','NIU','Niue','Oceania'),
  ('Norfolk Island','NF','NFK','Norfolk Island','Oceania'),
  ('Northern Mariana Islands','MP','MNP','Northern Mariana Islands','Oceania'),
  ('Norway','NO','NOR','Norge','Europe'),
  ('Oman','OM','OMN','Oman','Asia'),
  ('Pakistan','PK','PAK','Pakistan','Asia'),
  ('Palau','PW','PLW','Belau/Palau','Oceania'),
  ('Palestine, State of','PS','PSE','Filastin','Asia'),
  ('Panama','PA','PAN','RepÃºblica de PanamÃ¡','North America'),
  ('Papua New Guinea','PG','PNG','Papua New Guinea/Papua Niugini','Oceania'),
  ('Paraguay','PY','PRY','Paraguay','South America'),
  ('Peru','PE','PER','PerÃº/Piruw','South America'),
  ('Philippines','PH','PHL','Pilipinas','Asia'),
  ('Pitcairn','PN','PCN','Pitcairn','Oceania'),
  ('Poland','PL','POL','Polska','Europe'),
  ('Portugal','PT','PRT','Portugal','Europe'),
  ('Puerto Rico','PR','PRI','Puerto Rico','North America'),
  ('Qatar','QA','QAT','Qatar','Asia'),
  ('Reunion','RE','REU','Reunion','Africa'),
  ('Romania','RO','ROM','Romania','Europe'),
  ('Russian Federation','RU','RUS','Rossija','Europe'),
  ('Rwanda','RW','RWA','Rwanda/Urwanda','Africa'),
  ('Saint Helena, Ascension and Tristan da Cunha','SH','SHN','Saint Helena','Africa'),
  ('Saint Kitts and Nevis','KN','KNA','Saint Kitts and Nevis','North America'),
  ('Saint Lucia','LC','LCA','Saint Lucia','North America'),
  ('Saint Pierre and Miquelon','PM','SPM','Saint-Pierre-et-Miquelon','North America'),
  ('Saint Vincent and the Grenadines','VC','VCT','Saint Vincent and the Grenadines','North America'),
  ('Samoa','WS','WSM','Samoa','Oceania'),
  ('San Marino','SM','SMR','San Marino','Europe'),
  ('Sao Tome and Principe','ST','STP','SÃ£o TomÃ© e PrÃ­ncipe','Africa'),
  ('Saudi Arabia','SA','SAU','Al-Mamlaka al-Arabiya as-Saudiya','Asia'),
  ('Senegal','SN','SEN','SÃ©nÃ©gal/Sounougal','Africa'),
  ('Seychelles','SC','SYC','Sesel/Seychelles','Africa'),
  ('Sierra Leone','SL','SLE','Sierra Leone','Africa'),
  ('Singapore','SG','SGP','Singapore/Singapura/Xinjiapo/Singapur','Asia'),
  ('Slovakia','SK','SVK','Slovensko','Europe'),
  ('Slovenia','SI','SVN','Slovenija','Europe'),
  ('Solomon Islands','SB','SLB','Solomon Islands','Oceania'),
  ('Somalia','SO','SOM','Soomaaliya','Africa'),
  ('South Africa','ZA','ZAF','South Africa','Africa'),
  ('South Georgia and the South Sandwich Islands','GS','SGS','South Georgia and the South Sandwich Islands','Antarctica'),
  ('Spain','ES','ESP','EspaÃ±a','Europe'),
  ('Sri Lanka','LK','LKA','Sri Lanka/Ilankai','Asia'),
  ('Sudan','SD','SDN','As-Sudan','Africa'),
  ('Suriname','SR','SUR','Suriname','South America'),
  ('Svalbard and Jan Mayen','SJ','SJM','Svalbard og Jan Mayen','Europe'),
  ('Swaziland','SZ','SWZ','kaNgwane','Africa'),
  ('Sweden','SE','SWE','Sverige','Europe'),
  ('Switzerland','CH','CHE','Schweiz/Suisse/Svizzera/Svizra','Europe'),
  ('Syrian Arab Republic','SY','SYR','Suriya','Asia'),
  ('Taiwan (Province of China)','TW','TWN','Tai-wan','Asia'),
  ('Tajikistan','TJ','TJK','Tajikistan','Asia'),
  ('Tanzania, United Republic of','TZ','TZA','Tanzania','Africa'),
  ('Thailand','TH','THA','Prathet Thai','Asia'),
  ('Togo','TG','TGO','Togo','Africa'),
  ('Tokelau','TK','TKL','Tokelau','Oceania'),
  ('Tonga','TO','TON','Tonga','Oceania'),
  ('Trinidad and Tobago','TT','TTO','Trinidad and Tobago','North America'),
  ('Tunisia','TN','TUN','Tunis/Tunisie','Africa'),
  ('Turkey','TR','TUR','TÃ¼rkiye','Asia'),
  ('Turkmenistan','TM','TKM','TÃ¼rkmenistan','Asia'),
  ('Turks and Caicos Islands','TC','TCA','The Turks and Caicos Islands','North America'),
  ('Tuvalu','TV','TUV','Tuvalu','Oceania'),
  ('Uganda','UG','UGA','Uganda','Africa'),
  ('Ukraine','UA','UKR','Ukrajina','Europe'),
  ('United Arab Emirates','AE','ARE','Al-Amirat al-Arabiya al-Muttahida','Asia'),
  ('United Kingdom','GB','GBR','United Kingdom','Europe'),
  ('United States','US','USA','United States','North America'),
  ('United States Minor Outlying Islands','UM','UMI','United States Minor Outlying Islands','Oceania'),
  ('Uruguay','UY','URY','Uruguay','South America'),
  ('Uzbekistan','UZ','UZB','Uzbekiston','Asia'),
  ('Vanuatu','VU','VUT','Vanuatu','Oceania'),
  ('Venezuela','VE','VEN','Venezuela','South America'),
  ('Viet Nam','VN','VNM','Viet Nam','Asia'),
  ('Virgin Islands (British)','VG','VGB','British Virgin Islands','North America'),
  ('Virgin Islands (U.S.)','VI','VIR','Virgin Islands of the United States','North America'),
  ('Wallis and Futuna','WF','WLF','Wallis-et-Futuna','Oceania'),
  ('Western Sahara','EH','ESH','As-Sahrawiya','Africa'),
  ('Yemen','YE','YEM','Al-Yaman','Asia'),
  ('Zambia','ZM','ZMB','Zambia','Africa'),
  ('Zimbabwe','ZW','ZWE','Zimbabwe','Africa'),
  ('Afghanistan','AF','AFG','Afganistan/Afqanestan','Asia'),
  ('Algeria','DZ','DZA','Al-Jazair/Algerie','Africa');
`.trim(),
  },
  {
    id: 12,
    type: 'quickstart',
    title: 'Slack å…‹éš†',
    description: 'ä½¿ç”¨è¡Œçº§å®‰å…¨æ€§æ„å»ºåŸºç¡€çš„ Slack å…‹éš†ã€‚',
    sql: `
--
-- ç”¨äº https://github.com/supabase/supabase/tree/master/examples/slack-clone/nextjs-slack-clone

-- è‡ªå®šä¹‰ç±»å‹
create type public.app_permission as enum ('channels.delete', 'messages.delete');
create type public.app_role as enum ('admin', 'moderator');
create type public.user_status as enum ('ONLINE', 'OFFLINE');

-- ç”¨æˆ·è¡¨
create table public.users (
  id          uuid not null primary key, -- UUID from auth.users
  username    text,
  status      user_status default 'OFFLINE'::public.user_status
);
comment on table public.users is 'Profile data for each user.';
comment on column public.users.id is 'References the internal Supabase Auth user.';

-- é¢‘é“è¡¨
create table public.channels (
  id            bigint generated by default as identity primary key,
  inserted_at   timestamp with time zone default timezone('utc'::text, now()) not null,
  slug          text not null unique,
  created_by    uuid references public.users not null
);
comment on table public.channels is 'Topics and groups.';

-- æ¶ˆæ¯è¡¨
create table public.messages (
  id            bigint generated by default as identity primary key,
  inserted_at   timestamp with time zone default timezone('utc'::text, now()) not null,
  message       text,
  user_id       uuid references public.users not null,
  channel_id    bigint references public.channels on delete cascade not null
);
comment on table public.messages is 'Individual messages sent by each user.';

-- ç”¨æˆ·è§’è‰²
create table public.user_roles (
  id        bigint generated by default as identity primary key,
  user_id   uuid references public.users on delete cascade not null,
  role      app_role not null,
  unique (user_id, role)
);
comment on table public.user_roles is 'Application roles for each user.';

-- è§’è‰²æƒé™
create table public.role_permissions (
  id           bigint generated by default as identity primary key,
  role         app_role not null,
  permission   app_permission not null,
  unique (role, permission)
);
comment on table public.role_permissions is 'Application permissions for each role.';

-- æˆæƒå‡½æ•°ï¼Œä½¿ç”¨åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼ˆRBACï¼‰
create function public.authorize(
  requested_permission app_permission,
  user_id uuid
)
returns boolean as
$$
  declare
    bind_permissions int;
  begin
    select
      count(*)
    from public.role_permissions
    inner join public.user_roles on role_permissions.role = user_roles.role
    where
      role_permissions.permission = authorize.requested_permission and
      user_roles.user_id = authorize.user_id
    into bind_permissions;

    return bind_permissions > 0;
  end;
$$
language plpgsql security definer;

-- Secure the tables
alter table public.users
  enable row level security;
alter table public.channels
  enable row level security;
alter table public.messages
  enable row level security;
alter table public.user_roles
  enable row level security;
alter table public.role_permissions
  enable row level security;

create policy "Allow logged-in read access" on public.users
  for select using (auth.role() = 'authenticated');
create policy "Allow individual insert access" on public.users
  for insert with check ((select auth.uid()) = id);
create policy "Allow individual update access" on public.users
  for update using ( (select auth.uid()) = id );
create policy "Allow logged-in read access" on public.channels
  for select using (auth.role() = 'authenticated');
create policy "Allow individual insert access" on public.channels
  for insert with check ((select auth.uid()) = created_by);
create policy "Allow individual delete access" on public.channels
  for delete using ((select auth.uid()) = created_by);
create policy "Allow authorized delete access" on public.channels
  for delete using (authorize('channels.delete', auth.uid()));
create policy "Allow logged-in read access" on public.messages
  for select using (auth.role() = 'authenticated');
create policy "Allow individual insert access" on public.messages
  for insert with check ((select auth.uid()) = user_id);
create policy "Allow individual update access" on public.messages
  for update using ((select auth.uid()) = user_id);
create policy "Allow individual delete access" on public.messages
  for delete using ((select auth.uid()) = user_id);
create policy "Allow authorized delete access" on public.messages
  for delete using (authorize('messages.delete', auth.uid()));
create policy "Allow individual read access" on public.user_roles
  for select using ((select auth.uid()) = user_id);

-- å½“è¡¨å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå‘é€â€œæ—§æ•°æ®â€
alter table public.users
  replica identity full;
alter table public.channels
  replica identity full;
alter table public.messages
  replica identity full;

-- å‘ public.users è¡¨æ’å…¥ä¸€è¡Œå¹¶åˆ†é…è§’è‰²
create function public.handle_new_user()
returns trigger
set search_path = ''
as $$
  declare is_admin boolean;
  begin
    insert into public.users (id, username)
    values (new.id, new.email);

    select count(*) = 1 from auth.users into is_admin;

    if position('+supaadmin@' in new.email) > 0 then
      insert into public.user_roles (user_id, role) values (new.id, 'admin');
    elsif position('+supamod@' in new.email) > 0 then
      insert into public.user_roles (user_id, role) values (new.id, 'moderator');
    end if;

    return new;
  end;
$$ language plpgsql security definer;

-- æ¯å½“åˆ›å»ºç”¨æˆ·æ—¶è§¦å‘æ­¤å‡½æ•°
create trigger on_auth_user_created
  after insert on auth.users
  for each row execute procedure public.handle_new_user();

/**
 * REALTIME SUBSCRIPTIONS
 * åªå…è®¸å®æ—¶é€šä¿¡ç›‘å¬ public æ¨¡å¼ä¸‹çš„è¡¨ã€‚
 */

begin;
  -- åˆ é™¤å®æ—¶é€šä¿¡çš„è®¢é˜…
  drop publication if exists supabase_realtime;

  -- é‡æ–°åˆ›å»ºå®æ—¶é€šä¿¡çš„è®¢é˜…ï¼Œæš‚æ—¶ä¸åœ¨ä»»ä½•è¡¨ä¸Šå¯ç”¨
  create publication supabase_realtime;
commit;

-- å‘è®¢é˜…æ·»åŠ è¡¨
alter publication supabase_realtime add table public.channels;
alter publication supabase_realtime add table public.messages;
alter publication supabase_realtime add table public.users;

-- éšä¾¿æ’å…¥å‡ æ¡æ•°æ®
insert into public.users (id, username)
values
    ('8d0fd2b3-9ca7-4d9e-a95f-9e13dded323e', 'supabot');

insert into public.channels (slug, created_by)
values
    ('public', '8d0fd2b3-9ca7-4d9e-a95f-9e13dded323e'),
    ('random', '8d0fd2b3-9ca7-4d9e-a95f-9e13dded323e');

insert into public.messages (message, channel_id, user_id)
values
    ('Hello World ğŸ‘‹', 1, '8d0fd2b3-9ca7-4d9e-a95f-9e13dded323e'),
    ('Perfection is attained, not when there is nothing more to add, but when there is nothing left to take away.', 2, '8d0fd2b3-9ca7-4d9e-a95f-9e13dded323e');

insert into public.role_permissions (role, permission)
values
    ('admin', 'channels.delete'),
    ('admin', 'messages.delete'),
    ('moderator', 'messages.delete');
`.trim(),
  },
  {
    id: 13,
    type: 'quickstart',
    title: 'å¾…åŠåˆ—è¡¨',
    description: 'ä½¿ç”¨è¡Œçº§å®‰å…¨æ€§åˆ›å»ºä¸€ä¸ªåŸºç¡€çš„å¾…åŠåˆ—è¡¨ã€‚',
    sql: `
--
-- ç”¨äºï¼š
-- https://github.com/supabase/supabase/tree/master/examples/todo-list/sveltejs-todo-list æˆ–è€…
-- https://github.com/supabase/examples-archive/tree/main/supabase-js-v1/todo-list
--

create table todos (
  id bigint generated by default as identity primary key,
  user_id uuid references auth.users not null,
  task text check (char_length(task) > 3),
  is_complete boolean default false,
  inserted_at timestamp with time zone default timezone('utc'::text, now()) not null
);
alter table todos enable row level security;
create policy "Individuals can create todos." on todos for
    insert with check (auth.uid() = user_id);
create policy "Individuals can view their own todos. " on todos for
    select using ((select auth.uid()) = user_id);
create policy "Individuals can update their own todos." on todos for
    update using ((select auth.uid()) = user_id);
create policy "Individuals can delete their own todos." on todos for
    delete using ((select auth.uid()) = user_id);
`.trim(),
  },
  {
    id: 14,
    type: 'quickstart',
    title: 'Stripe è®¢é˜…',
    description: 'ç”¨äº Next.js Stripe è®¢é˜…çš„å…¥é—¨æ¨¡æ¿ã€‚',
    sql: `
/**
* ç”¨æˆ·è¡¨
* æ³¨æ„ï¼šæ­¤è¡¨åŒ…å«ç”¨æˆ·æ•°æ®ã€‚ç”¨æˆ·åªèƒ½æŸ¥çœ‹å’Œæ›´æ–°è‡ªå·±çš„æ•°æ®ã€‚
*/
create table users (
  -- å¼•ç”¨ auth.users çš„ UUID
  id uuid references auth.users not null primary key,
  full_name text,
  avatar_url text,
  -- å®¢æˆ·çš„è´¦å•åœ°å€ï¼Œä»¥ JSON æ ¼å¼å­˜å‚¨ã€‚
  billing_address jsonb,
  -- å­˜å‚¨å®¢æˆ·çš„æ”¯ä»˜æ–¹å¼ã€‚
  payment_method jsonb
);
alter table users
  enable row level security;
create policy "Can view own user data." on users
  for select using ((select auth.uid()) = id);
create policy "Can update own user data." on users
  for update using ((select auth.uid()) = id);

/**
* å½“ç”¨æˆ·é€šè¿‡ Supabase Auth å®Œæˆæ³¨å†Œæ—¶ï¼Œæ­¤è§¦å‘å™¨ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªç”¨æˆ·æ¡ç›®ã€‚
*/
create function public.handle_new_user()
returns trigger
set search_path = ''
as $$
  begin
    insert into public.users (id, full_name, avatar_url)
    values (new.id, new.raw_user_meta_data->>'full_name', new.raw_user_meta_data->>'avatar_url');
    return new;
  end;
$$
language plpgsql security definer;

create trigger on_auth_user_created
  after insert on auth.users
  for each row
    execute procedure public.handle_new_user();

/**
* å®¢æˆ·è¡¨
* æ³¨æ„ï¼šè¿™æ˜¯ä¸€å¼ ç§æœ‰è¡¨ï¼ŒåŒ…å«ç”¨æˆ· ID åˆ° Stripe å®¢æˆ· ID çš„æ˜ å°„ã€‚
*/
create table customers (
  -- å¼•ç”¨ auth.users çš„ UUID
  id uuid references auth.users not null primary key,
  -- ç”¨æˆ·åœ¨ Stripe ä¸Šçš„å®¢æˆ· IDã€‚ç”¨æˆ·ä¸åº”è¯¥æ›´æ–°æ­¤ IDã€‚
  stripe_customer_id text
);
alter table customers enable row level security;
-- å› ä¸ºè¿™æ˜¯ä¸€å¼ ç§æœ‰è¡¨ï¼Œç”¨æˆ·ä¸åº”è¯¥æœ‰è®¿é—®æƒé™ï¼Œæ‰€æœ‰ä¸è®¾ç½®ç­–ç•¥ã€‚

/**
* äº§å“è¡¨
* æ³¨æ„ï¼šäº§å“çš„åˆ›å»ºå’Œç®¡ç†åœ¨ Stripe ä¸Šå®Œæˆï¼Œå¹¶é€šè¿‡ Stripe webhooks åŒæ­¥åˆ°æˆ‘ä»¬çš„æ•°æ®åº“ã€‚
*/
create table products (
  -- Stripe ä¸Šäº§å“çš„ IDï¼Œä¾‹å¦‚ prod_1234ã€‚
  id text primary key,
  -- è¯¥äº§å“å½“å‰æ˜¯å¦å¯ä¾›è´­ä¹°ã€‚
  active boolean,
  -- äº§å“çš„åç§°ï¼Œæ—¨åœ¨ä¾›é¡¾å®¢æŸ¥çœ‹ã€‚æ¯å½“é€šè¿‡è®¢é˜…é”€å”®æ­¤äº§å“æ—¶ï¼Œåç§°ä¼šæ˜¾ç¤ºåœ¨ç›¸å…³å‘ç¥¨è¡Œé¡¹ç›®æè¿°ä¸­ã€‚
  name text,
  -- äº§å“çš„æè¿°ï¼Œæ—¨åœ¨ä¾›é¡¾å®¢æŸ¥çœ‹ã€‚å¯ç”¨äºå­˜å‚¨é”€å”®äº§å“çš„è¯¦ç»†è¯´æ˜ï¼Œä»¥ä¾¿è‡ªå·±æŒ‰éœ€æ˜¾ç¤ºã€‚
  description text,
  -- äº§å“å›¾ç‰‡çš„ URLï¼Œæ—¨åœ¨ä¾›é¡¾å®¢æŸ¥çœ‹ã€‚
  image text,
  -- ç”¨äºå­˜å‚¨å¯¹è±¡çš„é™„åŠ ä¿¡æ¯çš„é”®å€¼å¯¹é›†åˆã€‚
  metadata jsonb
);
alter table products
  enable row level security;
create policy "Allow public read-only access." on products
  for select using (true);

/**
* ä»·æ ¼è¡¨
* æ³¨æ„ï¼šä»·æ ¼çš„åˆ›å»ºå’Œç®¡ç†åœ¨ Stripe ä¸Šå®Œæˆï¼Œå¹¶é€šè¿‡ Stripe webhooks åŒæ­¥åˆ°æˆ‘ä»¬çš„æ•°æ®åº“ã€‚
*/
create type pricing_type as enum ('one_time', 'recurring');
create type pricing_plan_interval as enum ('day', 'week', 'month', 'year');
create table prices (
  -- Stripe ä¸Šä»·æ ¼çš„ IDï¼Œä¾‹å¦‚ price_1234ã€‚
  id text primary key,
  -- è¯¥ä»·æ ¼æ‰€å±çš„äº§å“çš„ IDã€‚
  product_id text references products,
  -- è¯¥ä»·æ ¼æ˜¯å¦å¯ä¾›è´­ä¹°äº§å“æ—¶ä½¿ç”¨ã€‚
  active boolean,
  -- ä»·æ ¼çš„ç®€è¦æè¿°ã€‚
  description text,
  -- ä»·æ ¼çš„å•ä½é‡‘é¢ï¼Œä»¥æœ€å°è´§å¸å•ä½è¡¨ç¤ºï¼ˆä¾‹å¦‚ï¼Œ100 ç¾åˆ†è¡¨ç¤º US$1.00 æˆ– 100 æ—¥å…ƒè¡¨ç¤º Â¥100ï¼Œæ— å°æ•°ä½è´§å¸å•ä½ï¼‰ã€‚
  unit_amount bigint,
  -- 3 ä¸ªå­—æ¯çš„ ISO è´§å¸ä»£ç ï¼Œå°å†™ã€‚
  currency text check (char_length(currency) = 3),
  -- å–å€¼ä¸º \`one_time\` æˆ– \`recurring\`ï¼Œç”¨äºæŒ‡ç¤ºä»·æ ¼æ˜¯ä¸€æ¬¡æ€§è´­ä¹°è¿˜æ˜¯å®šæœŸï¼ˆè®¢é˜…ï¼‰è´­ä¹°ã€‚
  type pricing_type,
  -- è®¢é˜…æ”¶è´¹çš„å‘¨æœŸã€‚å–å€¼ä¸º \`day\`ã€\`week\`ã€\`month\` æˆ– \`year\`ã€‚
  interval pricing_plan_interval,
  -- è®¢é˜…å‡ºè´¦å•ä¹‹é—´çš„é—´éš”æ•°é‡ï¼ˆåœ¨ \`interval\` å±æ€§ä¸­æŒ‡å®šï¼‰ã€‚ä¾‹å¦‚ï¼Œ\`interval=month\` å’Œ \`interval_count=3\` è¡¨ç¤ºæ¯ 3 ä¸ªæœˆå‡ºä¸€æ¬¡è´¦å•ã€‚
  interval_count integer,
  -- å½“[\`trial_from_plan=true\`](https://stripe.com/docs/api#create_subscription-trial_from_plan)æ—¶ï¼Œå½“å®¢æˆ·è®¢é˜…æ­¤ä»·æ ¼æ—¶çš„é»˜è®¤è¯•ç”¨å¤©æ•°ã€‚
  trial_period_days integer,
  -- ç”¨äºå­˜å‚¨å¯¹è±¡é™„åŠ ä¿¡æ¯çš„é”®å€¼å¯¹é›†åˆã€‚
  metadata jsonb
);
alter table prices
  enable row level security;
create policy "Allow public read-only access." on prices
  for select using (true);

/**
* è®¢é˜…è¡¨
* æ³¨æ„ï¼šè®¢é˜…çš„åˆ›å»ºå’Œç®¡ç†åœ¨ Stripe ä¸Šå®Œæˆï¼Œå¹¶é€šè¿‡ Stripe webhooks åŒæ­¥åˆ°æˆ‘ä»¬çš„æ•°æ®åº“ã€‚
*/
create type subscription_status as enum ('trialing', 'active', 'canceled', 'incomplete', 'incomplete_expired', 'past_due', 'unpaid');
create table subscriptions (
  -- Stripe ä¸Šè®¢é˜…çš„ IDï¼Œä¾‹å¦‚ sub_1234ã€‚
  id text primary key,
  user_id uuid references auth.users not null,
  -- è®¢é˜…å¯¹è±¡çš„çŠ¶æ€ï¼Œå–å€¼ä¸º subscription_status ç±»å‹ä¸­çš„ä¸€ä¸ªã€‚
  status subscription_status,
  -- ç”¨äºå­˜å‚¨å¯¹è±¡é™„åŠ ä¿¡æ¯çš„é”®å€¼å¯¹é›†åˆã€‚
  metadata jsonb,
  -- ç”¨äºåˆ›å»ºæ­¤è®¢é˜…çš„ä»·æ ¼çš„ IDã€‚
  price_id text references prices,
  -- è®¢é˜…çš„æ•°é‡ä¹˜ä»¥ä»·æ ¼çš„å•ä½é‡‘é¢ï¼Œç”¨äºè®¡ç®—æ­¤è®¢é˜…çš„æ€»é‡‘é¢ã€‚å¯ç”¨äºåœ¨è®¢é˜…æ—¶ä¸€æ¬¡æ€§è´­ä¹°å¤šä¸ªåå¸­ã€‚
  quantity integer,
  -- å¦‚æœä¸º trueï¼Œåˆ™è¡¨ç¤ºç”¨æˆ·åœ¨è®¡è´¹å‘¨æœŸç»“æŸåå–æ¶ˆè®¢é˜…ï¼Œå¹¶ä¸”å°†åœ¨ç»“æŸæ—¶è¢«åˆ é™¤ã€‚
  cancel_at_period_end boolean,
  -- è®¢é˜…åˆ›å»ºçš„æ—¶é—´ã€‚
  created timestamp with time zone default timezone('utc'::text, now()) not null,
  -- è®¢é˜…å‘ç¥¨çš„å¼€å§‹æ—¶é—´ã€‚
  current_period_start timestamp with time zone default timezone('utc'::text, now()) not null,
  -- è®¢é˜…å‘ç¥¨çš„ç»“æŸæ—¶é—´ã€‚åœ¨è¿™ä¸ªå‘¨æœŸç»“æŸæ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å‘ç¥¨ã€‚
  current_period_end timestamp with time zone default timezone('utc'::text, now()) not null,
  -- å¦‚æœè®¢é˜…ç»ˆæ­¢ï¼Œæ­¤æ—¶é—´æˆ³è¡¨ç¤ºè®¢é˜…ç»ˆæ­¢çš„æ—¥æœŸã€‚
  ended_at timestamp with time zone default timezone('utc'::text, now()),
  -- è¡¨ç¤ºè®¢é˜…è‡ªåŠ¨å–æ¶ˆçš„æ—¶é—´ã€‚
  cancel_at timestamp with time zone default timezone('utc'::text, now()),
  -- å¦‚æœè®¢é˜…è¢«å–æ¶ˆï¼Œå–æ¶ˆçš„æ—¥æœŸã€‚å¦‚æœè®¢é˜…ä½¿ç”¨äº† \`cancel_at_period_end\`ï¼Œåˆ™ \`canceled_at\` ä»ç„¶åæ˜ åˆå§‹å–æ¶ˆè¯·æ±‚çš„æ—¥æœŸï¼Œè€Œä¸æ˜¯è®¢é˜…è‡ªåŠ¨ç§»åŠ¨åˆ°å–æ¶ˆçŠ¶æ€æ—¶çš„ç»“æŸæ—¥æœŸã€‚
  canceled_at timestamp with time zone default timezone('utc'::text, now()),
  -- å¦‚æœè®¢é˜…æœ‰è¯•ç”¨æœŸï¼Œè¯•ç”¨çš„å¼€å§‹æ—¶é—´ã€‚
  trial_start timestamp with time zone default timezone('utc'::text, now()),
  -- å¦‚æœè®¢é˜…æœ‰è¯•ç”¨æœŸï¼Œè¯•ç”¨çš„ç»“æŸæ—¶é—´ã€‚
  trial_end timestamp with time zone default timezone('utc'::text, now())
);
alter table subscriptions
  enable row level security;
create policy "Can only view own subs data." on subscriptions
  for select using ((select auth.uid()) = user_id);

/**
 * å®æ—¶é€šä¿¡è®¢é˜…è¡¨
 * åªå…è®¸å®æ—¶é€šä¿¡è®¢é˜… public æ¨¡å¼ä¸‹çš„è¡¨ã€‚
 */
drop publication if exists supabase_realtime;
create publication supabase_realtime
  for table products, prices;
`.trim(),
  },
  {
    id: 15,
    type: 'quickstart',
    title: 'ç”¨æˆ·ç®¡ç†æ¨¡æ¿',
    description: 'è®¾ç½®ä¸€å¼  public æ¨¡å¼ä¸‹çš„ç”¨æˆ·èµ„æ–™è¡¨ï¼Œè®©æ‚¨å¯ä»¥é€šè¿‡ API è®¿é—®ã€‚',
    sql: `
-- åˆ›å»ºä¸€å¼  public æ¨¡å¼ä¸‹çš„ç”¨æˆ·èµ„æ–™è¡¨
create table profiles (
  id uuid references auth.users on delete cascade not null primary key,
  updated_at timestamp with time zone,
  username text unique,
  full_name text,
  avatar_url text,
  website text,

  constraint username_length check (char_length(username) >= 3)
);
-- è®¾ç½®è¡Œçº§å®‰å…¨æ€§ï¼ˆRLSï¼‰
-- è¯·å‚é˜… https://supabase.com/docs/guides/auth/row-level-security ä»¥è·å–æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚
alter table profiles
  enable row level security;

create policy "Public profiles are viewable by everyone." on profiles
  for select using (true);

create policy "Users can insert their own profile." on profiles
  for insert with check ((select auth.uid()) = id);

create policy "Users can update own profile." on profiles
  for update using ((select auth.uid()) = id);

-- æ­¤è§¦å‘å™¨ä¼šåœ¨é€šè¿‡ Supabase Auth å®Œæˆæ–°ç”¨æˆ·æ³¨å†Œæ—¶è‡ªåŠ¨åˆ›å»ºä¸€ä¸ªç”¨æˆ·èµ„æ–™æ¡ç›®ã€‚
-- è¯·å‚é˜… https://supabase.com/docs/guides/auth/managing-user-data#using-triggers ä»¥è·å–æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚
create function public.handle_new_user()
returns trigger
set search_path = ''
as $$
begin
  insert into public.profiles (id, full_name, avatar_url)
  values (new.id, new.raw_user_meta_data->>'full_name', new.raw_user_meta_data->>'avatar_url');
  return new;
end;
$$ language plpgsql security definer;
create trigger on_auth_user_created
  after insert on auth.users
  for each row execute procedure public.handle_new_user();

-- è®¾ç½®å¯¹è±¡å­˜å‚¨ï¼
insert into storage.buckets (id, name)
  values ('avatars', 'avatars');

-- è®¾ç½®å¯¹è±¡å­˜å‚¨çš„è®¿é—®æ§åˆ¶ã€‚
-- è¯·å‚é˜… https://supabase.com/docs/guides/storage#policy-examples ä»¥è·å–æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚
create policy "Avatar images are publicly accessible." on storage.objects
  for select using (bucket_id = 'avatars');

create policy "Anyone can upload an avatar." on storage.objects
  for insert with check (bucket_id = 'avatars');
`.trim(),
  },
  {
    id: 16,
    type: 'quickstart',
    title: 'NextAuth åº“è¡¨ç»“æ„è®¾ç½®',
    description: 'è®¾ç½® NextAuth Supabase Adapter çš„åº“è¡¨ç»“æ„ã€‚',
    sql: `
--
-- Name: next_auth; Type: SCHEMA;
--
CREATE SCHEMA next_auth;

GRANT USAGE ON SCHEMA next_auth TO service_role;
GRANT ALL ON SCHEMA next_auth TO postgres;

--
-- åˆ›å»ºç”¨æˆ·è¡¨
--
CREATE TABLE IF NOT EXISTS next_auth.users
(
    id uuid NOT NULL DEFAULT gen_random_uuid(),
    name text,
    email text,
    "emailVerified" timestamp with time zone,
    image text,
    CONSTRAINT users_pkey PRIMARY KEY (id),
    CONSTRAINT email_unique UNIQUE (email)
);

GRANT ALL ON TABLE next_auth.users TO postgres;
GRANT ALL ON TABLE next_auth.users TO service_role;

--- ç”¨äº RLS ç­–ç•¥çš„ uid() å‡½æ•°
CREATE FUNCTION next_auth.uid() RETURNS uuid
    LANGUAGE sql STABLE
    AS $$
  select
    coalesce(
        nullif(current_setting('request.jwt.claim.sub', true), ''),
        (nullif(current_setting('request.jwt.claims', true), '')::jsonb ->> 'sub')
    )::uuid
$$;

--
-- åˆ›å»º session è¡¨
--
CREATE TABLE IF NOT EXISTS  next_auth.sessions
(
    id uuid NOT NULL DEFAULT gen_random_uuid(),
    expires timestamp with time zone NOT NULL,
    "sessionToken" text NOT NULL,
    "userId" uuid,
    CONSTRAINT sessions_pkey PRIMARY KEY (id),
    CONSTRAINT sessionToken_unique UNIQUE ("sessionToken"),
    CONSTRAINT "sessions_userId_fkey" FOREIGN KEY ("userId")
        REFERENCES  next_auth.users (id) MATCH SIMPLE
        ON UPDATE NO ACTION
        ON DELETE CASCADE
);

GRANT ALL ON TABLE next_auth.sessions TO postgres;
GRANT ALL ON TABLE next_auth.sessions TO service_role;

--
-- åˆ›å»ºè´¦æˆ·è¡¨
--
CREATE TABLE IF NOT EXISTS  next_auth.accounts
(
    id uuid NOT NULL DEFAULT gen_random_uuid(),
    type text NOT NULL,
    provider text NOT NULL,
    "providerAccountId" text NOT NULL,
    refresh_token text,
    access_token text,
    expires_at bigint,
    token_type text,
    scope text,
    id_token text,
    session_state text,
    oauth_token_secret text,
    oauth_token text,
    "userId" uuid,
    CONSTRAINT accounts_pkey PRIMARY KEY (id),
    CONSTRAINT provider_unique UNIQUE (provider, "providerAccountId"),
    CONSTRAINT "accounts_userId_fkey" FOREIGN KEY ("userId")
        REFERENCES  next_auth.users (id) MATCH SIMPLE
        ON UPDATE NO ACTION
        ON DELETE CASCADE
);

GRANT ALL ON TABLE next_auth.accounts TO postgres;
GRANT ALL ON TABLE next_auth.accounts TO service_role;

--
-- åˆ›å»º verification_tokens è¡¨
--
CREATE TABLE IF NOT EXISTS  next_auth.verification_tokens
(
    identifier text,
    token text,
    expires timestamp with time zone NOT NULL,
    CONSTRAINT verification_tokens_pkey PRIMARY KEY (token),
    CONSTRAINT token_unique UNIQUE (token),
    CONSTRAINT token_identifier_unique UNIQUE (token, identifier)
);

GRANT ALL ON TABLE next_auth.verification_tokens TO postgres;
GRANT ALL ON TABLE next_auth.verification_tokens TO service_role;
`.trim(),
  },
  {
    id: 17,
    type: 'template',
    title: 'æœ€å¸¸è¢«è°ƒç”¨çš„æŸ¥è¯¢',
    description: 'åœ¨æ‚¨çš„æ•°æ®åº“ä¸­æœ€å¸¸è¢«è°ƒç”¨çš„æŸ¥è¯¢ã€‚',
    sql: `-- Most frequently called queries

-- åœ¨ä¸‹æ–¹æ·»åŠ äº†æœ€å¤š 100 æ¡çš„é™åˆ¶

select
    auth.rolname,
    statements.query,
    statements.calls,
    -- -- Postgres 13, 14, 15
    -- statements.total_exec_time + statements.total_plan_time as total_time,
    -- statements.min_exec_time + statements.min_plan_time as min_time,
    -- statements.max_exec_time + statements.max_plan_time as max_time,
    -- statements.mean_exec_time + statements.mean_plan_time as mean_time,
    -- -- Postgres <= 12
    total_time,
    min_time,
    max_time,
    mean_time,
    statements.rows / statements.calls as avg_rows

  from pg_stat_statements as statements
    inner join pg_authid as auth on statements.userid = auth.oid
  order by
    statements.calls desc
  limit
    100;`,
  },
  {
    id: 18,
    type: 'template',
    title: 'æœ€æ¶ˆè€—æ—¶é—´çš„æŸ¥è¯¢ç±»å‹',
    description: 'æŒ‰æŸ¥è¯¢ç±»å‹ç»Ÿè®¡æŸ¥è¯¢æ¶ˆè€—çš„æ—¶é—´ã€‚',
    sql: `-- æœ€æ¶ˆè€—æ—¶é—´çš„æŸ¥è¯¢ç±»å‹

-- åœ¨ä¸‹æ–¹æ·»åŠ äº†æœ€å¤š 100 æ¡çš„é™åˆ¶

select
    auth.rolname,
    statements.query,
    statements.calls,
    statements.total_exec_time + statements.total_plan_time as total_time,
    to_char(((statements.total_exec_time + statements.total_plan_time)/sum(statements.total_exec_time + statements.total_plan_time) over()) * 100, 'FM90D0') || '%' as prop_total_time
  from pg_stat_statements as statements
    inner join pg_authid as auth on statements.userid = auth.oid
  order by
    total_time desc
  limit
    100;`,
  },
  {
    id: 19,
    type: 'template',
    title: 'æœ€æ…¢çš„æŸ¥è¯¢',
    description: 'æ ¹æ®æœ€é•¿æ‰§è¡Œæ—¶é—´æ‰¾å‡ºæ…¢æŸ¥è¯¢ã€‚',
    sql: `-- æ ¹æ®æœ€é•¿æ‰§è¡Œæ—¶é—´æ‰¾å‡ºæ…¢æŸ¥è¯¢

-- åœ¨ä¸‹æ–¹æ·»åŠ äº†æœ€å¤š 100 æ¡çš„é™åˆ¶

select
    auth.rolname,
    statements.query,
    statements.calls,
    -- -- Postgres 13, 14, 15
    -- statements.total_exec_time + statements.total_plan_time as total_time,
    -- statements.min_exec_time + statements.min_plan_time as min_time,
    -- statements.max_exec_time + statements.max_plan_time as max_time,
    -- statements.mean_exec_time + statements.mean_plan_time as mean_time,
    -- -- Postgres <= 12
    total_time,
    min_time,
    max_time,
    mean_time,
    statements.rows / statements.calls as avg_rows
  from pg_stat_statements as statements
    inner join pg_authid as auth on statements.userid = auth.oid
  order by
    max_time desc
  limit
    100;`,
  },
  {
    id: 20,
    type: 'template',
    title: 'å‘½ä¸­ç‡',
    description: 'æŸ¥çœ‹æ‚¨çš„ç¼“å­˜å’Œç´¢å¼•å‘½ä¸­ç‡ã€‚',
    sql: `-- æŸ¥çœ‹ç¼“å­˜å’Œç´¢å¼•å‘½ä¸­ç‡

select
    'index hit rate' as name,
    (sum(idx_blks_hit)) / nullif(sum(idx_blks_hit + idx_blks_read),0) as ratio
  from pg_statio_user_indexes
  union all
  select
    'table hit rate' as name,
    sum(heap_blks_hit) / nullif(sum(heap_blks_hit) + sum(heap_blks_read),0) as ratio
  from pg_statio_user_tables;`,
  },
  {
    id: 21,
    type: 'quickstart',
    title: 'OpenAI å‘é‡æœç´¢',
    description: 'Next.js OpenAI æ–‡æ¡£æ£€ç´¢å…¥é—¨çš„æ¨¡æ¿ã€‚',
    sql: `
-- å¯ç”¨ pg_vector æ‰©å±•
create extension if not exists vector with schema public;

-- åˆ›å»ºè¡¨
create table "public"."nods_page" (
  id bigserial primary key,
  parent_page_id bigint references public.nods_page,
  path text not null unique,
  checksum text,
  meta jsonb,
  type text,
  source text
);
alter table "public"."nods_page" enable row level security;

create table "public"."nods_page_section" (
  id bigserial primary key,
  page_id bigint not null references public.nods_page on delete cascade,
  content text,
  token_count int,
  embedding vector(1536),
  slug text,
  heading text
);
alter table "public"."nods_page_section" enable row level security;

-- åˆ›å»º embedding ç›¸ä¼¼åº¦æœç´¢å‡½æ•°
create or replace function match_page_sections(embedding vector(1536), match_threshold float, match_count int, min_content_length int)
returns table (id bigint, page_id bigint, slug text, heading text, content text, similarity float)
language plpgsql
as $$
#variable_conflict use_variable
begin
  return query
  select
    nods_page_section.id,
    nods_page_section.page_id,
    nods_page_section.slug,
    nods_page_section.heading,
    nods_page_section.content,
    (nods_page_section.embedding <#> embedding) * -1 as similarity
  from nods_page_section

  -- æˆ‘ä»¬åªå…³å¿ƒå†…å®¹é•¿åº¦å¤§äºæœ€å°å†…å®¹é•¿åº¦çš„éƒ¨åˆ†
  where length(nods_page_section.content) >= min_content_length

  -- å› ä¸º Postgres é™åˆ¶ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦å¯¹å‘é‡ç‚¹ç§¯å–è´Ÿ
  and (nods_page_section.embedding <#> embedding) * -1 > match_threshold

  -- OpenAI embeddings è¢«æ ‡å‡†åŒ–åˆ°é•¿åº¦ 1ï¼Œ
  -- æ‰€ä»¥ä½™å¼¦ç›¸ä¼¼åº¦å’Œç‚¹ç§¯ä¼šäº§ç”Ÿç›¸åŒçš„ç»“æœã€‚
  -- æˆ‘ä»¬ä½¿ç”¨ç‚¹ç§¯ï¼Œå®ƒå¯ä»¥è¢«æ›´å¿«åœ°è®¡ç®—ã€‚
  --
  -- å¯¹äºä¸åŒçš„è¯­æ³•ï¼Œè¯·å‚é˜… https://github.com/pgvector/pgvector
  order by nods_page_section.embedding <#> embedding

  limit match_count;
end;
$$;

create or replace function get_page_parents(page_id bigint)
returns table (id bigint, parent_page_id bigint, path text, meta jsonb)
language sql
as $$
  with recursive chain as (
    select *
    from nods_page
    where id = page_id

    union all

    select child.*
      from nods_page as child
      join chain on chain.parent_page_id = child.id
  )
  select id, parent_page_id, path, meta
  from chain;
$$;
`.trim(),
  },
  {
    id: 22,
    type: 'template',
    title: 'å¤åˆ¶åŒæ­¥çŠ¶æ€æŠ¥å‘Š',
    description: 'æŸ¥çœ‹æ‚¨çš„å¤åˆ¶æ§½å’Œå¤åˆ¶åŒæ­¥æ»åçš„çŠ¶æ€ã€‚',
    sql: `-- å¤åˆ¶åŒæ­¥çŠ¶æ€æŠ¥å‘Š

SELECT
  s.slot_name,
  s.active,
  COALESCE(r.state, 'N/A') as state,
  COALESCE(r.client_addr, null) as replication_client_address,
  GREATEST(0, ROUND((redo_lsn-restart_lsn)/1024/1024/1024, 2)) as replication_lag_gb
FROM pg_control_checkpoint(), pg_replication_slots s
LEFT JOIN pg_stat_replication r ON (r.pid = s.active_pid);
`,
  },
  {
    id: 23,
    type: 'quickstart',
    title: 'LangChain',
    description: 'LangChain æ˜¯ä¸€ä¸ªæµè¡Œçš„æ¡†æ¶ï¼Œç”¨äºé›†æˆ AIã€å‘é‡å’Œ embeddingsã€‚',
    sql: `
-- å¯ç”¨ pgvector æ‰©å±•ä»¥ä½¿ç”¨å‘é‡
create extension vector;

-- åˆ›å»ºä¸€å¼ è¡¨ç”¨äºæ‚¨çš„å­˜å‚¨æ–‡æ¡£
create table documents (
  id bigserial primary key,
  content text, -- corresponds to Document.pageContent
  metadata jsonb, -- corresponds to Document.metadata
  embedding vector(1536) -- 1536 works for OpenAI embeddings, change if needed
);

-- åˆ›å»ºä¸€ä¸ªå‡½æ•°ç”¨äºæœç´¢æ–‡æ¡£
create function match_documents (
  query_embedding vector(1536),
  match_count int default null,
  filter jsonb DEFAULT '{}'
) returns table (
  id bigint,
  content text,
  metadata jsonb,
  similarity float
)
language plpgsql
as $$
#variable_conflict use_column
begin
  return query
  select
    id,
    content,
    metadata,
    1 - (documents.embedding <=> query_embedding) as similarity
  from documents
  where metadata @> filter
  order by documents.embedding <=> query_embedding
  limit match_count;
end;
$$;
`.trim(),
  },
  {
    id: 24,
    type: 'template',
    title: 'å®‰è£… dbdev',
    description:
      'dbdev æ˜¯ä¸€ä¸ªç”¨äºåœ¨æ‚¨çš„æ•°æ®åº“ä¸­å®‰è£…å¯ä¿¡è¯­è¨€æ‰©å±• (TLE)çš„å·¥å…·ã€‚',
    sql: `
/*---------------------
----   å®‰è£… dbdev   ----
-----------------------
éœ€è¦å®‰è£…ï¼š
  - pg_tle: https://github.com/aws/pg_tle
  - pgsql-http: https://github.com/pramsey/pgsql-http

è­¦å‘Šï¼š
åœ¨å·²å®‰è£…çš„ TLE çš„æ•°æ®åº“ä¸Šä½¿ç”¨é€»è¾‘å¤‡ä»½ä¼šæ¢å¤å¤±è´¥ã€‚
å› æ­¤ï¼Œdbdev åªèƒ½åœ¨å¯ç”¨ç‰©ç†å¤‡ä»½çš„æ•°æ®åº“ä¸Šä½¿ç”¨ã€‚
*/
create extension if not exists http with schema extensions;
create extension if not exists pg_tle;
select pgtle.uninstall_extension_if_exists('supabase-dbdev');
drop extension if exists "supabase-dbdev";
select
    pgtle.install_extension(
        'supabase-dbdev',
        resp.contents ->> 'version',
        'PostgreSQL package manager',
        resp.contents ->> 'sql'
    )
from http(
    (
        'GET',
        'https://api.database.dev/rest/v1/'
        || 'package_versions?select=sql,version'
        || '&package_name=eq.supabase-dbdev'
        || '&order=version.desc'
        || '&limit=1',
        array[
            ('apiKey', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhtdXB0cHBsZnZpaWZyYndtbXR2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE2ODAxMDczNzIsImV4cCI6MTk5NTY4MzM3Mn0.z2CN0mvO2No8wSi46Gw59DFGCTJrzM0AQKsu_5k134s')::http_header
        ],
        null,
        null
    )
) x,
lateral (
    select
        ((row_to_json(x) -> 'content') #>> '{}')::json -> 0
) resp(contents);
create extension "supabase-dbdev";
select dbdev.install('supabase-dbdev');
drop extension if exists "supabase-dbdev";
create extension "supabase-dbdev";
`.trim(),
  },
  {
    id: 25,
    type: 'template',
    title: 'å¤§å¯¹è±¡',
    description: 'åˆ—å‡ºæ•°æ®åº“ä¸­çš„å¤§å¯¹è±¡ï¼ˆè¡¨/ç´¢å¼•ï¼‰ã€‚',
    sql: `SELECT
    SCHEMA_NAME,
    relname,
    table_size
  FROM
    (SELECT
      pg_catalog.pg_namespace.nspname AS SCHEMA_NAME,
      relname,
      pg_relation_size(pg_catalog.pg_class.oid) AS table_size
    FROM pg_catalog.pg_class
    JOIN pg_catalog.pg_namespace ON relnamespace = pg_catalog.pg_namespace.oid
    ) t
  WHERE SCHEMA_NAME NOT LIKE 'pg_%'
  ORDER BY table_size DESC
  LIMIT 25`.trim(),
  },
  {
    id: 26,
    type: 'template',
    title: 'é™åˆ¶ MFA éªŒè¯ä¸ºæ¯ 2 ç§’ä¸€æ¬¡',
    description:
      'åˆ›å»ºä¸€ä¸ª Auth hookï¼Œé™åˆ¶ MFA éªŒè¯ä¸ºæ¯ 2 ç§’ä¸€æ¬¡ã€‚',
    sql: `
create function public.hook_mfa_verification_attempt(event jsonb)
  returns jsonb
  language plpgsql
as $$
  declare
    last_failed_at timestamp;
  begin
    if event->'valid' is true then
      -- éªŒè¯ç æœ‰æ•ˆï¼Œé€šè¿‡
      return jsonb_build_object('decision', 'continue');
    end if;

    select last_failed_at into last_failed_at
      from public.mfa_failed_verification_attempts
      where
        user_id = (event->'user_id')::uuid
          and
        factor_id = event->'factor_id';

    if last_failed_at is not null and now() - last_failed_at < interval '2 seconds' then
      -- éªŒè¯å¤ªé¢‘ç¹äº†
      return jsonb_build_object(
        'error', jsonb_build_object(
          'http_code', 429,
          'message',   'Please wait a moment before trying again.'
        )
      );
    end if;

    --è®°å½•éªŒè¯å¤±è´¥çš„æ¬¡æ•°
    insert into public.mfa_failed_verification_attempts
      (
        user_id,
        factor_id,
        last_refreshed_at
      )
      values
      (
        event->'user_id',
        event->'factor_id',
        now()
      )
      on conflict do update
        set last_refreshed_at = now();

    -- æœ€ç»ˆè®© Supabase Auth å†³å®šéªŒè¯å¤±è´¥çš„é»˜è®¤è¡Œä¸º
    return jsonb_build_object('decision', 'continue');
  end;
$$;

-- é…ç½®åˆé€‚çš„è®¿é—®æƒé™
grant execute
  on function public.hook_mfa_verification_attempt
  to supabase_auth_admin;

grant all
  on table public.mfa_failed_verification_attempts
  to supabase_auth_admin;

revoke execute
  on function public.hook_mfa_verification_attempt
  from authenticated, anon, public;

revoke all
  on table public.mfa_failed_verification_attempts
  from authenticated, anon, public;

grant usage on schema public to supabase_auth_admin;`.trim(),
  },
  {
    id: 27,
    type: 'template',
    title: 'æ·»åŠ  Auth Hook ï¼ˆä½¿ç”¨å¯†ç éªŒè¯ï¼‰',
    description:
      'åˆ›å»ºä¸€ä¸ª Auth Hookï¼Œç”¨äºé™åˆ¶å¯†ç éªŒè¯åªèƒ½æ¯ 10 ç§’ä¸€æ¬¡',
    sql: `
create function public.hook_password_verification_attempt(event jsonb)
returns jsonb
language plpgsql
as $$
  declare
    last_failed_at timestamp;
  begin
    if event->'valid' is true then
      -- å¯†ç æœ‰æ•ˆï¼Œé€šè¿‡
      return jsonb_build_object('decision', 'continue');
    end if;

    select last_failed_at into last_failed_at
      from public.password_failed_verification_attempts
      where
        user_id = (event->'user_id')::uuid;

    if last_failed_at is not null and now() - last_failed_at < interval '10 seconds' then
      -- éªŒè¯å¤ªé¢‘ç¹äº†
      return jsonb_build_object(
        'error', jsonb_build_object(
          'http_code', 429,
          'message',   'Please wait a moment before trying again.'
        )
      );
    end if;

    -- è®°å½•å¤±è´¥çš„éªŒè¯
    insert into public.password_failed_verification_attempts
      (
        user_id,
        last_failed_at
      )
      values
      (
        event->'user_id',
        now()
      )
      on conflict do update
        set last_failed_at = now();

    -- æœ€ç»ˆè®© Supabase Auth å†³å®šéªŒè¯å¤±è´¥çš„é»˜è®¤è¡Œä¸º
    return jsonb_build_object('decision', 'continue');
  end;
$$;

-- é…ç½®åˆé€‚çš„æƒé™
grant execute
  on function public.hook_password_verification_attempt
  to supabase_auth_admin;

grant all
  on table public.password_failed_verification_attempts
  to supabase_auth_admin;

revoke execute
  on function public.hook_password_verification_attempt
  from authenticated, anon, public;

revoke all
  on table public.password_failed_verification_attempts
  from authenticated, anon, public;

grant usage on schema public to supabase_auth_admin;`.trim(),
  },
  {
    id: 28,
    type: 'template',
    title: 'æ·»åŠ  Auth Hook ï¼ˆè‡ªå®šä¹‰è®¿é—®ä»¤ç‰Œï¼‰',
    description: 'åˆ›å»ºä¸€ä¸ª Auth Hookï¼Œç”¨äºç”³è¯·è‡ªå®šä¹‰è®¿é—®ä»¤ç‰Œ',
    sql: `
-- å‡è®¾åœ¨ç”¨æˆ·èµ„æ–™è¡¨ä¸Šæœ‰ä¸€ä¸ª is_admin å­—æ®µã€‚
create or replace function public.custom_access_token_hook(event jsonb)
returns jsonb
language plpgsql
as $$
  declare
    claims jsonb;
    is_admin boolean;
  begin
    -- æ£€æŸ¥åœ¨ç”¨æˆ·èµ„æ–™è¡¨ä¸Šè¯¥ç”¨æˆ·æ˜¯å¦ä¸º admin
    select is_admin into is_admin from profiles where user_id = (event->>'user_id')::uuid;

    -- ä»…å½“ç”¨æˆ·æ˜¯ admin çš„æ—¶å€™ç»§ç»­è¿›è¡Œä¸‹ä¸€æ­¥
    if is_admin then
      claims := event->'claims';

      -- æ£€æŸ¥åœ¨ claim ä¸­æ˜¯å¦æœ‰ 'user_metadata'
      if jsonb_typeof(claims->'user_metadata') is null then
        -- å¦‚æœ 'user_metadata' ä¸å­˜åœ¨ï¼Œåˆ›å»ºä¸€ä¸ªç©ºå¯¹è±¡
        claims := jsonb_set(claims, '{user_metadata}', '{}');
      end if;

      -- è®¾ç½®ä¸€ä¸ª 'admin' çš„ claim
      claims := jsonb_set(claims, '{user_metadata, admin}', 'true');

      -- æ›´æ–°åŸå§‹äº‹ä»¶ä¸­çš„ 'claims' å¯¹è±¡
      event := jsonb_set(event, '{claims}', claims);
    end if;

    -- è¿”å›ä¿®æ”¹è¿‡çš„æˆ–è€…åŸå§‹çš„äº‹ä»¶
    return event;
  end;
$$;

grant execute
  on function public.custom_access_token_hook
  to supabase_auth_admin;

revoke execute
  on function public.custom_access_token_hook
  from authenticated, anon, public;

grant usage on schema public to supabase_auth_admin;`.trim(),
  },

  {
    id: 29,
    type: 'template',
    title: 'æ·»åŠ  Auth Hook ï¼ˆé€šç”¨ï¼‰',
    description: 'åˆ›å»ºä¸€ä¸ª Auth Hook',
    sql: `
create or replace function public.custom_access_token_hook(event jsonb)
returns jsonb
language plpgsql
as $$
declare
  -- åœ¨è¿™é‡Œæ·»åŠ å˜é‡å£°æ˜
begin
  -- åœ¨è¿™é‡Œæ·»åŠ å¤„ç†é€»è¾‘
  return event;
end;
$$;
-- è®¾ç½® hook çš„æƒé™
grant execute on function public.custom_access_token_hook to supabase_auth_admin;
revoke execute on function public.custom_access_token_hook from authenticated, anon, public;
    `,
  },
]
